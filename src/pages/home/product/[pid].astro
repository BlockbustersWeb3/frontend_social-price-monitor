---
import Layout from '../../../layouts/Layout.astro';
import data from '../../../../public/data.json';
import '../../../../assets/scss/astro-ecommerce.scss';
import Navbar from '../../../components/navbar';
import UpperNavbar from '../../../components/store/upperNavbar';
import CardProduct from '../../../components/products/cardProduct';
import ProductOverviewGrid from '../../../components/products/productOverviewGrid';
import StoreDoubleColumn from '../../../components/store/storeDoubleColumn';
import ReviewSummaryChart from '../../../components/reviews/reviewSummaryChart';
import MainContainer from '../../../components/authentication/MainContainer';
import NavbarDashboard from '../../../components/navbar_dashboard';

export async function getStaticPaths() {
  let products = await fetch(`${import.meta.env.NETLIFY_URL}/.netlify/functions/get-product-list`)
    .then(res => res.json()).then((response) => {
      console.log('--- built product pages ---')
      return response.products.edges
    });

  return products.map((p, i) => {
    return {
      params: {pid: p.node.handle},
      props: {product: p},
    };
  });
}

// filter reviews with ID 01
// let productReviews = data.reviews.filter(x => x.productID == "01");
const { product } = Astro.props;
---

<Layout title="Product Page">
    <MainContainer client:load>
      <NavbarDashboard client:load></NavbarDashboard>
      <div class="container mt-5">
        <ProductOverviewGrid  
          colors={product[0].colors}
          images={product[0].images}
          title={product[0].title}
          full_description={product[0].full_description}
          price={product[0].price}
          highlights={product[0].highlights}
          details={product[0].details}
          rating={product[0].rating}
          reviews={product[0].reviews}
          sizes={product[0].sizes}
        />    

        <!-- <div class="my-5">
          <ReviewSummaryChart reviews = {productReviews}/>
        </div>

        <div class="row">
          <h5 class="mb-4">Customers also purchased</h5>
          {data.products.map(product => 
            <div class="col-md-6 col-lg-3">
              <CardProduct 
                thumb_src = {product.thumb_src}
                thumb_alt = {product.thumb_alt}
                color = {product.color}
                title = {product.title}
                price = {product.price}
                position = "left"
              />
            </div>
          )}        
        </div> -->
        <hr class="dark horizontal my-5" />
        <StoreDoubleColumn />
      </div>
    </MainContainer>
</Layout>